
{{! ========================================================== }}
{{! ========================================================== }}
{{! ==================Application ============================ }}
{{! ========================================================== }}
{{! ========================================================== }}
apiVersion: v1                      
kind: Namespace
metadata:
  name: {{{namespace}}}                             
---
apiVersion: app.k8s.io/v1beta1
kind: Application
metadata:
  name: {{{name}}}
  namespace: {{{namespace}}}
spec:
  componentKinds:
  - group: apps.open-cluster-management.io
    kind: Subscription
  descriptor: {}
  selector:
    matchExpressions:
      - key: app
        operator: In
        values: 
          - {{{name}}}


{{! ========================================================== }}
{{! ========================================================== }}
{{! ==================Channel(s) ============================= }}
{{! ========================================================== }}
{{! ========================================================== }}


{{#each channels}}

{{#switch channelType}}

{{! ========================================================== }}
{{! ========================================================== }}
{{! ==================Github channel ========================= }}
{{! ========================================================== }}
{{! ========================================================== }}
{{#case 'github'}}
---
apiVersion: apps.open-cluster-management.io/v1
kind: Channel
metadata:
  name: {{{../../name}}}-{{{../channelName}}}
  namespace: {{{../../namespace}}}
spec:
  type: GitHub
  pathname: https://github.com/open-cluster-management/gitops-clusters.git
  secretRef:
    name: github-gitops-clusters
---
apiVersion: v1
kind: Secret
metadata:
  name: github-gitops-clusters
  namespace: gitops-cluster-lifecycle
data:
  user: dXNlcgo=            # Value of user and accessToken is Base 64 coded.
  accessToken: cGFzc3dvcmQ      
{{/case}}


{{! ========================================================== }}
{{! ========================================================== }}
{{! ==================Helmrepo channel ==================== }}
{{! ========================================================== }}
{{! ========================================================== }}
{{#case 'helmrepo'}}
---
apiVersion: apps.open-cluster-management.io/v1
kind: Channel
metadata:
  name: {{{../name}}}-{{{channelName}}}
  namespace: {{{../name}}}
---
apiVersion: v1
kind: Namespace
metadata:
  name: hub-repo
spec:
  type: HelmRepo
  pathname: https://9.21.107.150:8443/helm-repo/charts # URL points to a valid chart URL.
  configRef:
    name: insecure-skip-verify
---
apiVersion: v1
data:
  insecureSkipVerify: "true"
kind: ConfigMap
metadata:
  name: insecure-skip-verify
  namespace: hub-repo 
  
{{/case}}


{{! ========================================================== }}
{{! ========================================================== }}
{{! ==================Objectstore channel ==================== }}
{{! ========================================================== }}
{{! ========================================================== }}
{{#case 'objectstore'}}
---
apiVersion: apps.open-cluster-management.io/v1
kind: Channel
metadata:
  name: {{{../name}}}-{{{channelName}}}
  namespace: {{{../name}}}
spec:
 type: ObjectBucket
 pathname: http://9.28.236.243:31311/dev
 secretRef:
   name: miniosecret
 gates:
   annotations:
     dev-ready: true
       
{{/case}}


{{! ========================================================== }}
{{! ========================================================== }}
{{! ==================Deployable channel ===================== }}
{{! ========================================================== }}
{{! ========================================================== }}
{{#case 'deployable'}}
  
{{/case}}


{{! ========================================================== }}
{{! ========================================================== }}
{{! ==================Secret channel ========================= }}
{{! ========================================================== }}
{{! ========================================================== }}
{{#case 'secret'}}
  
{{/case}}

{{/switch}}
{{/each}}
  
{{! ========================================================== }}
{{! ========================================================== }}
{{! ==================Subscription =========================== }}
{{! ========================================================== }}
{{! ========================================================== }}
---
apiVersion: apps.open-cluster-management.io/v1
kind: Subscription
metadata:
  name:
  namespace:
spec:
  channel:
  placement: 
    placementRef: 
      kind: PlacementRule
      name:
timeWindow: 
  type: {{#if time-window-block-mode}} "block" {{else}} "active" {{/if}}
  location: "America/Toronto"
  weekdays:
  hours:


{{! ========================================================== }}
{{! ========================================================== }}
{{! ==================Placement Rule ========================= }}
{{! ========================================================== }}
{{! ========================================================== }}

---
apiVersion: apps.open-cluster-management.io/v1
kind: PlacementRule
metadata:
  name:
  namespace:
spec:
  clusterSelector:
    matchLabels:
  clusterReplicas:
  {{#if online-cluster-only-checkbox}}
  clusterConditions:
    - type: ManagedClusterConditionAvailable
      status: "True"
  {{/if}}